# RH124 v8 - Red Hat System Administration I
Several of the labs can be run from a local install of RHEL or CentOS.  This not only 
saves online lab time but allows greater flexibility in experimenting and getting
hands-on experience.

These instructions assume you have a base RHEL or CentOS system installed.  I
recommend using [VirtualBox](https://www.virtualbox.org/) to install 
an OS which can be saved or deleted as needed.

Be sure to create a shared folder with your VM so you can copy files between the
host and the VM.

Chapters:  
[Chapter 2: Accessing the Command Line](#chapter-2---accessing-the-command-line)  
[Chapter 3: Managing Files From the Command Line](#chapter-3---managing-files-from-the-command-line)  
[Chapter 4: Getting Help in Red Hat Enterprise Linux](#chapter-4---getting-help-in-rhel)  
[Chapter 5: Creating, Viewing, and Editing Text Files](#chapter-5---creating-viewing-and-editing-text-files)  
[Chapter 6: Managing Local Users and Groups](#chapter-6---managing-local-users--groups)  
[Chapter 7: Controlling Access to Files](#chapter-7---controlling-access-to-files)  
[Chapter 8: Monitoring and Managing Linux Processes](#chapter-8---monitoring-and-managing-processes)  
[Chapter 9: Controlling Services and Daemons](#chapter-9---controlling-services-and-daemons)  
[Chapter 10: Configuring and Securing SSH](#chapter-10---configuring-and-securing-ssh)  
[Chapter 11: Analyzing and Storing Logs](#chapter-11---analyzing-and-storing-logs)  
[Chapter 12: Managing Networking](#chapter-12---manage-networking)  
[Chapter 13: Archiving and Transferring Files](#chapter-13---archiving-and-transferring-files)  
[Chapter 14: Installing and Updating Software Packages](#chapter-14---installing-and-updating-software-packages)  
[Chapter 15: Accessing Linux File Systems](#chapter-15---accessing-linux-file-systems)  
[Chapter 16: Analyzing Servers and Getting Support](#chapter-16---analyzing-servers-and-getting-support)  

## Chapter 2 - Accessing the Command Line

Commands to know:
* `Ctrl+Alt+F2-F6` can be used to cycle through consoles.  `Ctrl+Alt+F1` returns to main console / graphical desktop
* `Super+M` opens the message tray.  `Super` is often the Windows key on PCs
* `Ctrl+Alt+UpArrow` and `Ctrl+Alt+DownArrow` can switch between workspaces
* `Super+L` locks screen
* `Super` twice and hold opens Activities overview
* `Ctrl+Alt+Del` powers off or restarts the system (doesn't work in a VirtualBox environment)
* `ssh user@host` to remotely log in to a remote system. Use `-i mykey.pem` to specify private key file
* `exit` to exit a session

* `passwd` to change your password
* `;` is used to separate commands on a single line
* `whoami` shows currently logged in user
* `date` shows date/time info.  Use `+%R` for time, `+%x` for date
* `file <fn>` to view the type of file
* `cat <fn>` views contents of file
* `head <fn>` to view the beginning of a file, use `-n <num>` to display num lines
* `tail <fn>` to view the end of a file, use `-n <num>` to display num lines
* `wc <fn>` to perform a word count on a file.  Use `-l`, `-w`, or `-c` to count lines, words, or characters
* `<tab>` once completes argument, twice shows available options
* `\` at end of line allows command continuation on another line
* `history` shows command history
* `!` runs prevous command.  `!<num>` runs command from history corresponding to num.  `!<str>` runs most
recent command starting with string text

### `bash` command line editing shortcuts
* `Ctrl+a` - Jump to beginning of command line
* `Ctrl+e` - Jump to end of command line
* `Ctrl+u` - Clear from cursor to beginning of command line
* `Ctrl+k` - Clear from cursor to end of command line
* `Ctrl+LeftArrow` - Jump to beginning of previous word
* `Ctrl+RightArrow` - Jump to end of next word
* `Ctrl+r` - Search history for pattern
* `Esc+.` - copies last argument from previous command
* `Alt+.` - like above but allows for cycling through previous commands
More commands are [listed here](http://teohm.com/blog/shortcuts-to-move-faster-in-bash-command-line/)

### Labs
Labs can be run mostly as-is.  If you want to create a user named `student`, run the following
commands (assumes currently logged in user has admin authority):
```
sudo adduser student
sudo passwd student
```
Enter `student` for the password twice.  You may receive a warning about a short password.  
If you want `student` to be able to issue admin commands:
```
sudo usermod -aG wheel student
```

The `zcat` file can be found in the `/usr/bin` directory.  


## Chapter 3 - Managing Files from the Command Line
Important directories:
* `/` - System root directory
* `/usr` - Installed software and static data:
  * `/usr/bin` - User commands
  * `/usr/sbin` - System admin commands
  * `/usr/local` - Locally customized software
* `/etc` - Configuration files
* `/var` - Variable, persistent data (logs, web content, databases, etc)
* `/run` - Runtime data, not persistent
* `/home` - User home directories
* `/root` - Root's home directory
* `/tmp` - Temporary files, deleted automatically after certain period
* `/boot` - System boot files
* `/dev` - Device files

Use `man hier` to see a list of directories.

Relative directories:
* `.` - Current directory
* `..` - Previous (parent) directory
* `~` - Current user's home directory, use `~username` for a user's home directory

Commands to know:
* `pwd` - Display current working directory
* `ls` - List files, use `-l` to get more details, `-a` to include hidden files, `-R` to recurse directories
* `cd <dir>` - Change current working directory.  If `<dir>` not specified switches to user's home directory. `cd -` switches to previous working directory
* `touch <fn>` - Update a file's timestamp without otherwise modifying it.  Can also be used to create empty files

File management commands:
* `cp <fn1> <fn2>` - Copy file fn1 to fn2, use `-r` to recurse directories
* `mv <fn1> <fn2>` - Move file (or directory) fn1 to fn2, can also be used to rename files
* `rm <fn>` - Remove (delete) file or directory, use `-r` to recurse directories, `-f` to not prompt for confirmation
* `mkdir <dir>` - Create new directory.  Use `-p` to create multiple levels at once
* `rmdir <dir>` - Remove empty directory

Link commands:
* `ln <fn1> <fn2>` - Creates hard link `fn2` from file `fn1`
* `ls -il` shows inode number of file.  Hard links have same inode number
* `ln -s` - creates symbolic link

Command Line Pattern matching (globbing):
* `*` - Any string (0+ characters)
* `?` - Single character
* `~+` - Current working directory
* `~-` - Previous working directory
* `[abc...]` - Any one character from list
* `[!abc...]` - Any one character not from list (also `[^abc...]`)
* `[[:alpha:]]`, `[[:lower:]]`, `[[:upper:]]`, `[[:alnum:]]`, `[[:punc:]]`, `[[:digit:]]`, `[[:space:]]`

Brace expansion:
Use `{}` to generate list of strings:
* `{1..5}` or `{a..e}` - sequences
* `{a,b,c}` - list

Variable expansion:  
* `VARNAME=value` to set the value of a variable
* `$VARNAME` or `${VARNAME}` to reference the variable

Command substitution:
* `$(command)` or ```command``` - Output of `command` is inserted into command string.  Backtick method not recommended
* `\` - Escape character
* `'single quotes'` - Interpret all text literally
* `"double quotes"` - Interpret text literally but still allow command substitution

### Labs
Labs can be run as documented.

## Chapter 4 - Getting Help in RHEL
`man` manual sections are [listed here](http://man7.org/linux/man-pages/man7/man-pages.7.html).  

`man` navigation:
* `Spacebar` or `PageDown` - down one screen
* `PageUp` - up one screen
* `DownArrow` or `UpArrow` - down or up one line
* `d` or `u` - down or up 1/2 screen
* `/ <str>` - Search down for str, or use regex pattern
* `n` or `N` - repeat search down or up
* `g` or `G` - Jump to begining or ending of page
* `q` - quit

`man` command:
* `man <topic>` - opens first topic 
* `man <num> <topic>` - opens topic in `num` section
* `man -k <str>` - searches for keyword in titles/descriptions
* `man -K <str>` - searches for keyword in all text

`pinfo` command:
* View the `/etc/pinforc` file to see listing of key mappings

Documentation for packages may be stored in the `/usr/shared/doc/<pkgname>` directory.

### Labs
Labs can be run as documented.

## Chapter 5 - Creating, Viewing, and Editing Text Files
Channels:
* *0* - stdin
* *1* - stdout
* *2* - stderr

Redirection:
* `>filename` - redirects output to filename (overwriting if exists)
* `>>filename` - redirects output to filename (appending if exists)
* `2>filename` - redirects stderr to filename
* `2>/dev/null` - discards stderr output
* `>filename 2>&1` or `&>filename` - redirects both stdout and stderr to same file
* `command1 | command2` - pipes stdout from command1 to stdin to command2

Use `tee` to save to file and pipe, ie:
```
ls -l | tee /myfile | less
```

Editing:
`vim` cheat sheet is [available here](https://vim.rtorr.com/).

Shell environment:
* `VARNAME=value` - to set the value of a variable
* `$VARNAME` or `${VARNAME}` - to reference the variable
* `set` - shows all variables
* `export VARNAME` - makes `VARNAME` an environment variable available to both shell and programs
* `export VARNAME=value` - set and export in one line
* `unset VARNAME` - removes variable, also unexports
* `export -n VARNAME` - removes environment variable without unsetting it

Common environment variables:
* `PS1` - sets the command prompt
* `PATH` - sets the path
* `EDITOR` - sets default editor

Set variables automatically by editing `~/.bashrc` file

### Labs
Labs can be run as documented.

## Chapter 6 - Managing Local Users & Groups

Commands to know:
* `id` - shows info about current user
* `ps` - view process info, use option `a` for all processes and `u` to view user info
* `ls -l` - long directory listing showing user/group info

* `su - username` - Switch to user, `-` sets up user's environment.  If no username
specifed *root* is assumed
* `sudo <command>` - Run command using root access
* `sudo -i` - Start root account shell

User / Group commands:
* `useradd <username>` - create a new user
* `usermod` - modifies user.  See `--help` for options
* `userdel <username>` - removes user.  Use `-r` to remove home directory
* `passwd <username>`  - to set password

* `groupadd <group>` - adds a group, `-g` specifies GID, `-r` creates system group
* `groupmod` - modifies group.  See help
* `groupdel <group>` - removes group.  Group can't be primary group for any user
* `usermod -g <group> <user>` - change primary group for user
* `usermod -aG <group> <user>` - adds a supplementary group to a user

* `chage` - used to change password expiry rules.  See `--help` for parameters
  * `date` command can be helpful.  Ie, `date -d "+45 days"`
  * `chage -d 0 <user>` to force password change at first login

* `usermod -s /sbin/nologin <userid>` - For a user with no shell

`/etc/passwd` contains user information.  Despite file name, no passwords.  Sample entry:
```
bill:x:1000:1000:Bill:/home/bill:/bin/bash
```
Fields are:
```
username:dummy password:UID:Primary GID:User's real name:Home directory:Shell
```
`/etc/group` contains group information.  Sample entry:
```
wheel:x:10:bill,student
```
Fields are:
```
Groupname:Dummy password:GID:List of users (comma separated)
```

UID ranges:
* 0 - root
* 1-200 - system users assigned by Red Hat
* 201-999 - unprivileged system users, no file ownership
* 1000+ - regular users

`/etc/shadow` stores password information.  Sample entry:
```
bill:$6$lOopA.bs...opo4h4yY/::0:99999:7:::
```
Fields are:
```
username:Encrypted password:Last changed date:Min days before change (0 no min):Max days:Warning days:Days active after expiration:expiration date:reserved
```

`/etc/login.defs` is a configuration file for default user creation settings

### `root`
`root` is the superuser.  Generally not advised to log in as root.  You may run commands
as root in various ways:

* `su -` - start root command shell.  Need to know root's password
* `sudo <command>` - runs a command as root.  Log in with user's password.  Using `sudo`:
  * Don't need `root`'s password
  * Permissions stored in `/etc/sudoers` file
  * Commands logged in `/var/log/secure`
  * Members of group `wheel` have permission by default
  * To edit permissions, run `visudo`
  * `-i` option sets up target user environment

### Labs
Labs can be run as documented.  If you want to create a user named `operator1`, run the following
commands (assumes currently logged in user has admin authority):
```
sudo adduser operator1
sudo passwd operator1
sudo usermod -aG wheel operator1
```

## Chapter 7 - Controlling Access to Files
Permissions:  

| Permission | On File | On Directory |
| :------: |:----| :-----|
| r | Read file | Directory can be listed |
| w | Change file | Files may be created/deleted |
| x | Execute as command | Contents may be accessed |

Use long directory list to see permissions: `ls -l`.  
* 1st character:
  * `-` - regular file
  * `d` - directory
  * `l` - symbolic link
* Next 9 characters, three groups of three showing permissions
for owner, group, and all other users

`chmod` changes permissions on files/directories.  Two forms:
1. Symbolic: `chmod WhoWhatWhich filename` where:
  * *Who* is [u, g, o, a] for [user, group, other, all]
  * *What* is [+, -, =] for [add, remove, set exactly]
  * *Which* is [r, w, x] for see above table
  * USe `X` to set `x` on directories only.  Used with `-R` option to
  recurse directories
2. Numeric: `chmod ### filename` where:
  * Each digit represents access level: user,group,other
  * Sum of r=4, w=2, x=1

`chown` changes ownership of files/directories.  
```
chown user:group file
```
Use `-R` to make a change recursively.

`chgrp` can be used to change group.

`umask` views or sets default permissions:
* Bits cause corresponding permissions to be unset
* With no parameters the current umask is shown
* System default umask defined in `/etc/profile` and `/etc/bashrc`
* User default umask defined in `~/.bashrc` and `~/bash_profile`

### Special permissions
* `u+s` - Executes as owner of file, not current user (no effect on directory)
* `g+s` - Executes as group of file, not current user.  For directory, new files have group
ownership matching that of directory
* `o+t` - (No effect on files).  Users can only remove their own files.
Set numerically with 4th digit on `chmod` command (setuid = 4; setgid = 2; sticky = 1)

### Labs
Labs can be run as documented.  Sample users and groups may need to be created first.

## Chapter 8 - Monitoring and Managing Processes
States:
* `R` - TASK_RUNNING
* `S` - TASK_INTERRUPTIBLE (waiting for condition)
* `D` - TASK_UNINTERRUPTIBLE, sleeping but will not respond to signals
* `K` - TASK_KILLABLE, similar to `D` but can be killed
* `T` - TASK_STOPPED, suspended, or TASK_TRACED, suspended for debug operations
* `Z` - EXIT_ZOMBIE
* `X` - EXIT_DEAD

`ps` command lists current processes.  Three options:
* UNIX (POSIX) options preceded by `-`
* BSD otions no dash
* GNU long options preceded by `--`

* `ps aux` - `a` lists all processes (not just current user), `u` user oriented format, `x` not use processes with a tty terminal
* `ps lax` - `l` long format
* `ps -ef` - `-e` lists all processes, `-f` full-format listing

`top` command shows live view of processes.  Press `h` or `?` to see list of commands

* `<command> &` to start job in background
* `jobs` to list jobs running
* `fg %<num>` to bring job to foreground
* To put current job in background:
  1. Press Ctrl+z to put in background and suspend
  2. `bg %<num>` to resume the job
* `ps j` shows job related process info

Signals interrupt processes.  Signal numbers can be found:
```
man 7 signal
```
```
       Signal     Value     Action   Comment
       ──────────────────────────────────────────────────────────────────────
       SIGHUP        1       Term    Hangup detected on controlling terminal
                                     or death of controlling process
       SIGINT        2       Term    Interrupt from keyboard
       SIGQUIT       3       Core    Quit from keyboard
       SIGILL        4       Core    Illegal Instruction
       SIGABRT       6       Core    Abort signal from abort(3)
       SIGFPE        8       Core    Floating point exception
       SIGKILL       9       Term    Kill signal
       SIGSEGV      11       Core    Invalid memory reference
       SIGPIPE      13       Term    Broken pipe: write to pipe with no
                                     readers
       SIGALRM      14       Term    Timer signal from alarm(2)
       SIGTERM      15       Term    Termination signal
       SIGUSR1   30,10,16    Term    User-defined signal 1
       SIGUSR2   31,12,17    Term    User-defined signal 2
       SIGCHLD   20,17,18    Ign     Child stopped or terminated
       SIGCONT   19,18,25    Cont    Continue if stopped
       SIGSTOP   17,19,23    Stop    Stop process
       SIGTSTP   18,20,24    Stop    Stop typed at terminal
       SIGTTIN   21,21,26    Stop    Terminal input for background process
       SIGTTOU   22,22,27    Stop    Terminal output for background process
```

* `kill <PID>` - Sends TERM signal to process
* `kill -s <signal> <PID>` - Sends specific signal to process
* `kill -l` - Lists signals
* `killall <command pattern>` - Sends signal to processes matching pattern, `-s` like `kill`, `-u` for user
* `pkill <command pattern>` - Like `killall`, `-<signal>` for signal, `-G` for group, `-P` for parent ID,
`-U` for user ID, `-t` for terminal

* `w` - Lists users currently logged in, `-f` shows FROM field
* `pgrep -l -u <user>` - Lists all processes owned by user
* `pkill -SIGKILL -u <user>` - Kills all processes owned by user
* `pstree` - Tree view of processes, `-u` for user

Load average values:
* `top`, `uptime`, `w`, `gnome-system-monitor` display the load average values
* Divide by number of vCPUs.  <1 satisfactory, >1 saturated
* Load averages given with 3 numbers showing last 1, 5, and 15 minutes
* `lscpu` shows CPU info
* `top`: `h` or `?` to show interactive keystrokes

### Labs
Labs can be run as documented.

## Chapter 9 - Controlling Services and Daemons
Unit types:  
* `.service` - system services
* `.socket` - socket for interprocess communications (IPC)
* `.path` - delay activation until system change

`systemctl` interacts with units:  
* `systemctl -t help` - list all units.
* `systemctl list-units --type=service` - show all loaded service units. `--all` shows all units
* `systemctl list-unit-files --type=service` - show unit files
* `systemctl status <unit>` - show status of a unit
* `systemctl is-active <unit>` - verify unit is active (running)
* `systemctl is-enabled <unit>` - verify unit is enabled (starts on boot)
* `systemctl is-failed <unit>` - verify unit failed during startup
* `systemctl --failed --type=service` - shows all failed services

* `systemctl start <unit>` - starts a unit.  `.service` is the default service type
* `systemctl stop <unit>` - stop a unit
* `systemctl restart <unit>` - stops & restarts a unit.  Unit receives new PID
* `systemctl reload <unit>` - reloads unit configuration (does not get a new PID)
* `systemctl reload-or-restart <unit>` - restarts if reload isn't available
* `systemctl list-dependencies <unit>` - lists unit dependencies.  `--reverse` lists units dependent on target
* `systemctl mask <unit>` - masks unit, prevents from starting.  Use `unmask` to reverse
* `systemctl enable <unit>` - unit starts at boot time.  Use `disable` to reverse

## Labs
Labs can be run as documented.  
The lab in section 4 uses `chronyd`.  By default this may not be started nor enabled on your CentOS system.  

## Chapter 10 - Configuring and Securing SSH
You will want to have at least one other system to test with.  Either install one from scratch or clone 
your existing system.  If you clone a system, be sure to give it a new host name.  To specify a new host
name:  
```
sudo hostnamectl set-hostname <new.host.name>
```

`ssh` is used to remotely log into another system:
* `ssh <remotehost>` - remotely logs in using current user name
* `ssh <user@remotehost>` - remotely logs in using a different user name
* `ssh <user@remotehost> <command>` - runs `<command>` on remote hosts and disconnects

Communication is secured using public key encryption.  Server sends public key to client before
client logs in.  Known hosts stored in:
* `/etc/ssh/ssh_known_hosts` - for system-wide configuration
* `~/.ssh/known-hosts` - for user level

Format of file:
```
remotehost,ip_address encryption_algorithm public_key
```

Public key on server stored in the `/etc/ssh` directory with extension `.pub`.

To allow authentication without passwords, use key-based authentication.  On the client:
* `ssh-keygen` - generate public/private key pair.  `-f filename` optionally sets output file names
* Default files `id_rsa` and `id_rsa.pub`
* Set permission 600 on private key and 644 on public key
* `ssh-copy-id -i <public_key> user@remotehost` - send public key to remote server
* `ssh -i <private_key> user@remotehost` - to log in.  Omit `-i` to use default key
* `eval $(ssh-agent)` - starts agent which remembers passphrase (if used)
* `ssh-add <private_key>` - adds passphrase to `ssh-agent`.  Omit file to use default key

On the server:
* Daemon is called `sshd`
* Configuration file: `/etc/ssh/sshd_config`
* `PermitRootLogin` - allows or denies root login through ssh. `yes`, `no`, or `without-password`
* `PasswordAuthentication` - set to `no` forces only private key-based login
* `systemctl reload sshd` - to activate configuration changes

### Labs
Labs can be run as documented.  You may want to create the `production1` and `production2` users on each system.

## Chapter 11 - Analyzing and Storing Logs
### Logging
Logs are usually kept in the `/var/log` directory.  Logging services include `systemd-journald` and `rsyslog`.

Syslog priorities:  

| Code | Priority | Severity |
| :---: | :------- | :------- |
| 0    | emerg    | System is unusable |
| 1    | alert    | Action must be taken immediately |
| 2    | crit     | Critical condition |
| 3    | err      | Non-critical error condition |
| 4    | warning  | Warning condition |
| 5    | notice   | Normal but significant event |
| 6    | info     | Informational event |
| 7    | debug    | Debugging-level message |

`rsyslog` configured using `/etc/rsyslog.conf` and `.conf` files located in `/etc/rsyslog.d` directory.

`logrotate` is used to rotate log files.

Syslog log files have the following format:
```
Time_stamp Host Program_name[PID] Message
Jan 23 07:35:54 centos8 sudo[15494]: pam_unix(sudo:session): session closed for user root
```
Use `tail -f <logfilename>` to monitor a log file.

Send messages to `rsyslog` manually using the `logger` command:
```
logger -p <facility> "Message text"
logger -p local7.notice "Log entry created on host"
```

`systemd-journald` stores journal in `/run/log`.   Non-persistent by default.
* `journalctl` - View entries in journal file.  `-n` only show last 10 log entries
* `journalctl -n <num>` - Show last n log entries
* `journalctl -f` - Like `tail -f`, live display of journal entries
* `journalctl -p err` - Shows only error and higher
* `journalctl --since today` - Shows entries since specified time/date, "YYYY-MM-DD hh:mm:ss", "-1 hour", etc
* `journalctl --until yesterday` - Shows entries before time.  Can be used with `--since`
* `man 7 systemd.time` for more details on specifying a time/date
* `journalctl -o verbose` - displays additional fields
* `journalctl <filter>` - filters messages.  `journalctl _SYSTEMD_UNIT=sshd.service _PID=1182`
* `man 7 systemd.journal-fields` for details on fields
* `journalctl -b <num>` - view entries for boot `<num>`.  Omit `<num>` for current boot.  Can be negative

Configuration is `/etc/systemd/journald.conf`.  Change `Storage` to make journal persistent.

### Time
Accurate time is important for logs, especially across multiple systems.

* `timedatectl` - Time related settings
* `timedatectl list-timezones` - database of available time zones
* `timedatectl set-timezone <timezone>` - sets the time zone
* `tzselect` - guided method for finding correct timezone
* `timedatectl set-time "YYYY-MM-DD hh:mm:ss"` - sets current date/time.  Either may be omitted
* `timedatectl set-ntp true` - Enables NTP sync.  Also `false` to disable.  Uses `chronyd`
* Configuration file: `/etc/chrony.conf`
* `systemctl restart chronyd` - after making changes
* `chronyc sources -v` - checks system is working

### Labs
Labs can be run as documented.  However, the lab NTP server will not be available.  

## Chapter 12 - Manage Networking
TCP/IP network model layers:

* Application - application-specific protocols like http, ssh, SMTP, etc
* Transport - TCP and UDP
* Internet - Network layer, IPv4 and IPv6 protocols
* Link - provides connection to physical layer, such as Ethernet or WLAN

Network interface naming:

* Starts with:
   * en - Ethernet
   * wl - WLAN
   * ww - WWAN
* Rest of name based on firmware or location in PCI topology:
   * oN - on board device
   * sN - PCI hotplug
   * pMsN - PCI device on bus M slot N

IPv4 is 32-bit number represented in decimal as four 8-bit octets (0-255).  Two parts: network and host.  All hosts on same subnet can communicate without router - same network part.  Netmask identifies how many bits of address belong to subnet. Represented as `255.255.255.0` or newer syntax `/24`.  Example:

```
IP Address: 10.0.0.5             = 00001010.00000000.00000000.00000101
Subnet mask: 255.255.255.0 (/24) = 11111111.11111111.11111111.00000000
                                   -------------------------- --------
                                               Network           Host
```

IPv6 is a 128-bit number represented by 8 colon-separated groups of 4 hexadecimal nibbles (four bits).  Ie, 
`fe80:0000:0000:0000:0008:987f:cef9:3d1c`.  
* Leading 0s can be ommitted - `fe80:0:0:0:8:987f:cef9:3d1c`
* Combine one or more blocks of 0s with one `::` - `fe80::8:987f:cef9:3d1c`
* Enclose in square brackets to separate from port number - `[fe80::8:987f:cef9:3d1c]:80`

Similar to IPv4, IPv6 has two parts: the network prefix and the interface ID.  Network part is always `/64` network mask.  Network part has two pieces - allocations and local subnets.

```
 Network Part          Interface ID
------------------- -------------------
fe80:0000:0000:0000:0008:987f:cef9:3d1c
-------------- ----
/48 allocations  |
               /16 for local subnets
```

Each interface has a link-local address which only works on the local network.  These start with `fe80` and is generated using `fe80::` and the MAC address for the rest of the digits.  To access a link scope address, use scope identifier (%): `ping6 fe80::8:987f:cef9:3d1c%enp0s3`

IPv6 has no broadcast address.  Multicast is used to send traffic to multiple systems.  `ping6 ff02::1%enp0s3` where 
`ff02::1` is the all-nodes link-local address.

Gather network and interface information:

* `ip link show` - lists available network interfaces
* `ip addr show enp0s3` - shows IP information for specified link
* `ip -s link show enp0s3` - shows statistics for specified link
* `ping <host_or_ip>` - checks connectivity to host.  Use `-cx` where `x` is a number to limit number of packets
* `ping6 <host_or_ip>%<interface>` - like ping but for IPv6
* `ip route` - shows IPv4 routing table.  Use `ip -6 route` for IPv6
* `tracepath <hostname>` - identify route to host through network.  `tracepath6` for IPv6.  Uses UDP by default.  `-I` for ICMP or `-T` for TCP
* `ss -ta` - socket statistics (replaces `netstat`)
* Commonly used ports listed in `/etc/services`

Configuring network interfaces:
* `nmcli dev status` - show status of all configured network devices
* `nmcli con show` - shows all connections.  Use `--active` for only active connections
* `nmcli con add` - adds a new connection
   * `nmcli con add con-name eno2 type ethernet ifname enp0s3` - uses DHCP
   * add `ipv4.address 192.168.0.5/24 ipv4.gateway 192.168.0.254` - to specify IPv4 address
   * add `ipv6.address 2001:db8:0:1::c000:207/64 ipv6.gateway 2001:db8:0:1::1` for IPv6 address
* `nmcli con up con-name` - activates connection
* `nmcli dev dis <device>` - disconnects device and brings it down
* `nmcli con show con-name` - lists current settings.  Settings in lowercase are static properties.  Uppercase are temporary for this instance of connection (ie, DHCP)
* `nmcli con mod` - change settings for a connection.  See `man 5 nm-settings` for details
* `nmcli con del con-name` - deletes connection
* `nmcli gen permissions` - check permissions

Changes made using `nmcli con mod` are saved to `/etc/sysconfig/network-scripts/ifcfg-<name>`.  If editing file manually run `nmcli con reload`.

* `hostname` - Displays host name 
* `hostnamectl set-hostname <hostname>` - sets a new hostname
* `hostnamectl status` - Displays host name info
* `/etc/hosts` - used to convert host names to IP addresses in conjunction with DNS
* `/etc/resolv.conf` - configuration file for DNS
* `nmcli con mod` - for multi-value parameters, use `+` to add, `-` to remove, otherwise it replaces
* `host <hostname>` - tests DNS connectivity, resolves host to address
* `host <ip_address>` - reverse DNS lookup

### Labs
Labs can be run as documented.  
You may need to use a different target host when running `tracepath` since `classroom.example.com` will not be available.  
After configuring a connection with a static address, you may want to manually delete it after the lab: `nmcli con del "static-addr"`.  
When setting a hostname, you may not have a static and a transient hostname to begin with.  To set up that part of the lab, remove your current hostname: `sudo hostnamectl set-hostname ""`.

## Chapter 13 - Archiving and Transferring Files
`tar` command for managing archive files:

* `-c` - creates new archive
* `-x` - extract files from archive
* `-t` - list files in archive
* `-v` - verbose
* `-f` - file to create or operate on
* `-p` - preserve permissions
* `-z` - gzip compression (`.tar.gz`)
* `-j` - bzip2 compression (`.tar.bz2`)
* `-J` - xz compression (`.tar.xz`)

Examples:

* `tar -cf archive.tar foo bar baz` - Archives files `foo`, `bar`, and `baz` into `archive.tar`
* `tar -tf archive.tar` - lists contents of `archive.tar`
* `tar -xf archive.tar` - extracts files from `archive.tar` into current directory
* `tar -czf archive.tar.gz /directory` - compresses directory into archive using gzip
* `tar -xzf archive.tar.gz` - extracts file from archive into current directory

Copying files between systems:

* `scp` - secure copy
* `scp localfile remoteuser@remotehost:remotedirectory` - from local to remote
* `scp remoteuser@remotehost:remotefile localdirectory` - from remote to local
* `scp -r` to recurse directories

* `sftp remoteuser@remotehost` - secure ftp to interactively copy files
* `put` and `get` to copy files to / from remote host

Synchronizing files:
* `rsync` - syncs files and directories
* `rsync <source> <target>` - also uses remote directories similar to `scp`
* `-a` - preserves most attributes, `-v` - verbose, `-n` - dry run
* Trailing `/` on source directory won't create that directory on target

### Labs
Labs can be run as documented.  You may want to use a 2nd VM for the file transfer labs.

## Chapter 14 - Installing and Updating Software Packages
If using CentOS, the system registration and subscription commands may not work as expected.  Installed Subscription Manager using:

```
sudo yum -y install subscription-manager
```

However, some commands will require you to have an account and appropriate licenses on the Red Hat Customer Portal.  My advice would be to not install Subscription Manager on a CentOS system unless you have a specific need.

* `subscription-manager register --username=<username> --password=<pw>` - register a system
* `... list --available` - list available subscriptions
* `... attach --auto` - auto-attach a subscription
* `... attach --pool=<poolID>` - attach subscription to specific pool
* `... list --consumed` - list consumed subscriptions
* `... unregister` - unregister system

RPM package manager:

* `name-version-release.architecture.rpm` - package name format
* `rpm -qa` - list all installed packages
* `rpm -qf <filename>` - determine which package provides `filename`
* `rpm -q <package>` - list version of package currently installed
   * `-qi` - lists detailed info
   * `-ql` - lists files
   * `-qc` - lists configuration files
   * `-qd` - lists documentation files
   * `-q --scripts` - lists shell script run before/after package is installed/removed
   * `-q --changelog` - list change info
* `rpm -ivh <package.rpm>` - installs local package file
* `rpm2cpio <package.rpm> | cpio -id` - extract files without installing

Yum package manager works with repositories and dependencies:

* `yum list 'http*'` - displays installed and available packages matching pattern
* `yum search <keywords>` - lists packages by keyword in name and summary fields
* `yum search all <keywords>` - searches name, summary, and description fields
* `yum info <package>` - lists details about package
* `yum provides <path>` - displays packages which match the path name

Installing removing packages with `yum`:

* `yum install <package>` - installs package, including dependencies
* `yum uppdate <package>` - installs newer version if available.  Without package specified it will update all packages
* `yum remove <package>` - removes package and dependencies not in use by other packages

* `yum group list` - shows names of installed and available groups
* `yum group info <groupname>` - lists details about group
* `yum group install <groupname>` - installs mandatory and default packages and dependencies

* `yum history` - history of install/remove transaction.  Logged in `/var/log/dnf.rpm.log`
* `yum history info x` - lists details about transaction `x`
* `yum history undo x` - reverses transaction `x`

* `yum repolist all` - lists configured repositories
* `yum-config-manager --enable <repo>` - enables repository
* `yum-config-manager --add-repo="http://dl.fedoraproject.org/pub/epel/8/x86_64/"` - adds repository

Yum repositories are stored in `/etc/yum.repos.d` and have extension `.repo`.  The format is:
```
[repo_name]
name=repo_name
baseurl=url_to_repo
enabled=1
gpgcheck=0
```

Module can have one or more module streams which hold different versions of the content.  Each stream can have independent updates.  One module stream can be enabled.  
Modules can have multiple profiles which define particular use cases.  Ie, default, client, server, dev, etc.

* `yum module list` - list available modules
* `yum module list <module>` - lists streams for module
* `yum module info <module>` - display module details
* `yum module info <module>:<stream>` - lists details about specific module stream.  `--profile` adds info for each profile
* `yum module install <module>` - installs module with default stream and profiles
* `yum module remove <module>` - removes module.  Module stream is still available
* `yum module disable <module>` - disables the module stream
* To switch module streams:
   * `yum module remove <module>`
   * `yum module reset <module>`
   * `yum module install <module>:<stream>`


### Labs
Labs can be run as documented.  However:
* `rhcsa-script-1.0.0-1.noarch.rpm` will not be available on your system
* Many example RPM files exist and are available for download.  An example is [the Z shell (zsh)](http://zsh.sourceforge.net/):
   * Download the rpm without installing it: `yum install -y zsh --downloadonly --downloaddir=.`
* `yum-config-manager` may not be installed by default.  To install: `yum -y install yum-utils`
* The Fedora EPEL 8 repository may not work.  You can enable the EPEL repository: `yum -y install epel-release`
* The classroom repository will not be available for the Section 08 lab, nor will `rht-updates`
* Postgresql module may not be installed by default.  To prepare the lab: `yum module install postgresql:9.6`

## Chapter 15 - Accessing Linux File Systems
Block device naming:

| Type | Naming Pattern |
| :--- | :---           |
| SATA/SAS/USB | `/dev/sda` |
| `virtio-blk` paravirtualized (some VMs) | `/dev/vda` |
| NVMe (SSDs) | `/dev/nvme0` |
| SD/MMC/eMMC (SD cards) | `/dev/mmcblk0` |

VirtualBox uses the `/dev/sdx` pattern.

Partitions add a number to the end of the device name, ie, `/dev/sda`.  Logical volumes (LVMs) create a directory under `/dev` using the volume group name, and a subdirectory under that for each logical volume.  Ie, `/dev/volgrp/logvol`.

Commands to know:

* `df` - display file systems and mount points.  `-h` uses human readable sizes in MiB, GiB, or `-H` for MB, GB
* `du <directory>` - shows disk usage, use `-h` for human redable sizes
* `lsblk` - list block devices.  `-fp` shows full path and UUIDs

Mounting devices:

* `mount <device> <directory>` - mounts a device making it accessable as directory.  For temporary mounts create a subdirectory under `/mnt`
* `mount UUID="xxx-xxx" <directory>` - mounts by UUID, safer than using device name since those can change
* `umount <directory>` - unmounts file system.  Must not be in use
* `lsof <directory>` - list open files

Finding files:

* `updatedb` - updates the locate database (happens daily automatically)
* `locate <file>` - searches for file in name or path, includes partial matches.  `-i` - case insensitive, `-n #` - limits number of returned matches
* `find <starting_dir> -name <file>` - finds files in realtime starting from starting_dir.  `-iname` case insensitive
* `find / -name '*.txt'` - wildcards too
* `find -user user` - finds files owned by user.  Also `-uid #`
* `find -group group` - finds files owned by group. Also `-gid #`
* `find -perm ###` - finds files with permissions. `/###` at least one bit set.  `-###` at least to match all bits
* `find -size size` - finds files by size rounded up.  `10M`.  `+10G` >10GB.  `-10k` <10kb
* `find -mmin n` - files changed `n` minutes ago.  `+n` or `-n` finds file greater or less than
* `find -type x` - by type.  `f` - regular file.  `d` - directory. `l` - sym link.  `b` - block device
* `find -links n` - files with `n` number of hard links.  Use `+n` or `-n` for great or less than

### Labs
The labs have you mount a second hard drive.  If using a VM you'll want to create a 2nd virtual hard drive and attach it to the VM.  In VirtualBox, open the VM settings, go to Storage, and add another hard drive under the SATA controller.  Your VM will need to be stopped in order to add a drive.

For VirtualBox, you can create and attach a hard drive from the command line using [VBoxManage](https://wspstech.blogspot.com/2020/01/create-virtualbox-hard-drive-from.html).

Once the drive has been added, start the VM, open a terminal window and switch to root.  Before mounting, the drive will need a file system.  This is covered later in this course, but here are the basic steps:

1. Be sure you are using the correct device.  Run `lsblk -fs` to list devices and file systems.  The device you added should not have an existing file system.  If it's the second drive, most likely the device name will be `sdb`
1. Create a partition on the drive using `fdisk`.  Run `fdisk /dev/sdb`.  You should see a message: `Device does not contain a recognized partition table.` If not, exit and double-check your device name
1. From the fdisk command prompt:
   1. `n` - create a new partition
   1. `p` - create primary partition
   1. `1` - partition number 1
   1. Press enter to accept the default First sector
   1. Press enter to accept the default last sector.  This creates one, large partition
   1. `w` - write the new partition table and exit fdisk
1. Run `lsblk`.  You should see your new parition in the tree under `sdb`, ie `sdb1`
1. Create the file system: `mkfs.ext4 /dev/sdb1`
1. Run `lsblk -fs`.  Your new partition should now show a file system of ext4

Use this device name (`sdb`, `sdb1`) instead of the `vdb`, `vdb1` device mentioned in the labs.

## Chapter 16 - Analyzing Servers and Getting Support
Cockpit provides web interface to administration.  This will also work on CentOS.  To install and run:

```
yum install cockpit
systemctl enable --now cockpit.socket
firewall-cmd --add-service=cockpit --permanent
firewall-cmd --reload
```

Access with URL: `https://servername:9090`. 

The Red Hat Support Tool will not be installed by default on CentOS.  To install: `yum install redhat-support-tool`.  You will need a Red Hat user ID and password to log on.

The Insights Client will be unable to connect unless you use a registered system.